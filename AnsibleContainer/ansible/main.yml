# This should be your Ansible playbooks to provision your containers.
# An inventory will be automatically created using the names of the services
# from your container.yml file.
# Add any roles or other modules you'll need to this directory too.
# For many examples of roles, check out Ansible Galaxy: https://galaxy.ansible.com/
#
---
- hosts: all
  gather_facts: false
  tasks:
    - name: low-down and dirty python install
      raw: 'which python || apt-get -y update && apt-get -y install python python-simplejson'

# Do DB stuff
- hosts: db
  tasks:
    - name: pull in db vars
      include_vars: vars/db.yml
    - name: install prereq
      package:
        name: "{{ item }}"
        state: present
      with_items: "{{ prerequisite_packages[ansible_os_family] }}"
    - name: Add user
      user:
        name: "{{ fg_user }}"
        comment: "FutureGateway user"

    -  name: Get DB from repo
       local_action:
         module: git
         repo: "{{ fg_fgAPIServer_git }}"
         dest: "/tmp/fgAPIServer"
         force: yes

    - name: Template DB config
      template:
        src: /tmp/fgAPIServer/fgapiserver_db.sql.j2
        dest: /tmp/fgapiserver_db.sql
